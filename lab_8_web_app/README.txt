Лабораторная работа №8. Клиент-серверное приложение на Python с использованием Jinja2

Выполнил: Голубев Артём Дмитриевич
ИСУ: 502712
Группа: Р3124


Задание:
Цель работы
Создать простое клиент-серверное приложение на Python без серверных фреймворков.
Освоить работу с HTTPServer и маршрутизацию запросов.
Применять шаблонизатор Jinja2 для отображения данных.
Реализовать модели предметной области (User, Currency, UserCurrency, App, Author) с геттерами и сеттерами.
Структурировать код в соответствии с архитектурой MVC.
Получать данные о курсах валют через функцию get_currencies и отображать их пользователям.
Реализовать функциональность подписки пользователей на валюты и отображение динамики их изменения.
Научиться создавать тесты для моделей и серверной логики.

1. Описание предметной области
Модели
Author
name — имя автора
group — учебная группа

App
name — название приложения
version — версия приложения
author — объект Author

User
id — уникальный идентификатор
name — имя пользователя

Currency
id — уникальный идентификатор
num_code — цифровой код
char_code — символьный код
name — название валюты
value — курс
nominal — номинал (за сколько единиц валюты указан курс)

Пример XML:

<Valute ID="R01280">
 <NumCode>360</NumCode>
 <CharCode>IDR</CharCode>
 <Nominal>10000</Nominal>
 <Name>Рупий</Name>
 <Value>48,6178</Value>
</Valute>
UserCurrency
id — уникальный идентификатор
user_id — внешний ключ к User
currency_id — внешний ключ к Currency
Реализует связь «много ко многим» между пользователями и валютами.

2. Архитектура проекта (MVC)
Рекомендуемая структура папок:

myapp/
├── models/
│ ├── __init__.py
│ ├── author.py
│ ├── app.py
│ ├── user.py
│ ├── currency.py
│ └── user_currency.py
├── templates/
│ ├── index.html
│ ├── users.html
│ └── currencies.html
├── static/
│ └── css, js, изображения
├── myapp.py
└── utils/
 └── currencies_api.py # функция get_currencies
Разделение ответственности (MVC):

Models — классы предметной области, геттеры и сеттеры.
Views (шаблоны Jinja2) — отображение данных для пользователя (templates/).
Controller (HTTPServer) — маршрутизация, обработка запросов, вызов моделей и шаблонов.

3. Задание
3.1. Реализовать модел
Создать модели User, Currency, UserCurrency, App по аналогии с Author.
Для каждого свойства реализовать геттер и сеттер с проверкой типов и корректности значений.
Модели должны быть расположены в пакете models.

3.2. Реализовать сервер
Использовать стандартный HTTPServer и BaseHTTPRequestHandler.

Поддерживать маршруты:
/ — главная страница с информацией о приложении и авторе
/users — список пользователей
/user?id=... — информация о конкретном пользователе и его подписках
/currencies — список валют с текущими курсами
/author — информация об авторе
Маршрутизация реализуется через self.path и urllib.parse.parse_qs.

3.3. Шаблоны Jinja2
Расположение шаблонов — все HTML-файлы должны находиться в папке templates/.
Инициализация объекта Environment:

from jinja2 import Environment, PackageLoader, select_autoescape
# Инициализация Environment один раз при старте приложения
env = Environment(
 loader=PackageLoader("myapp"), # "myapp" — название пакета с шаблонами
 autoescape=select_autoescape()
)
Почему так:
Объект Environment хранит кэш шаблонов и настройки Jinja2.
Инициализация один раз при старте приложения повышает производительность, шаблоны не подгружаются заново при каждом запросе.
Позволяет многократно рендерить шаблоны, передавая разные данные (модели, списки, переменные).
Загрузка шаблонов:

template_index = env.get_template("index.html")
template_users = env.get_template("users.html")
template_currencies = env.get_template("currencies.html")
4. Использование шаблонов в обработчике HTTP-запросов:

html_content = template_index.render(
 myapp="CurrenciesListApp",
 author_name=main_author.name,
 group=main_author.group,
 navigation=[{'caption': 'Главная', 'href': '/'}]
)
self.wfile.write(bytes(html_content.encode('utf-8')))
3.4. Работа с API курсов валют
Использовать ранее реализованную функцию get_currencies для получения данных о курсах валют.
Интегрировать получение курсов с моделями Currency.
Обновление курсов может происходить при каждом запросе /currencies или по кнопке «Обновить».

3.5. Самостоятельная работа (дополнительно)
На странице пользователя /user?id=... отображать график динамики курсов валют, на которые подписан пользователь.
График должен показывать изменения курса за последние 3 месяца.
Можно использовать JavaScript-библиотеки для визуализации (Chart.js, Plotly и т.д.).

4. Файлы проекта
Файл	Назначение
models/__init__.py	импорт всех моделей
models/author.py	класс Author
models/app.py	класс App
models/user.py	класс User
models/currency.py	класс Currency
models/user_currency.py	класс UserCurrency
templates/*.html	шаблоны страниц
myapp.py	запуск сервера и маршрутизация
utils/currencies_api.py	функция get_currencies
5. Рекомендации по MVC
Models — не содержат логики отображения и сетевой логики.
Views — не содержат бизнес-логики, только отображение данных.
Controller — получает запрос, вызывает модели, рендерит шаблон.
Разделение файлов и папок упрощает поддержку и расширение проекта.
Для подписок пользователей используйте отдельную сущность UserCurrency.

6. Рекомендации по тестированию
Тестирование моделей
Проверка геттеров и сеттеров.
Проверка выброса исключений при некорректных значениях.

Тестирование функции get_currencies
Проверка корректного получения курсов.
Прверка выброса исключений при ошибках сети, некорректном JSON и отсутствии валют.

Тестирование контроллера
Проверка корректного ответа на маршруты /, /users, /currencies.
Проверка обработки query-параметров (/user?id=...).

Тестирование шаблонов
Убедиться, что переменные корректно передаются в шаблон.
Проверить рендеринг циклов и условий.

7. Пример интеграции функции get_currencies
8. Требования к отчету
Отчёт должен содержать следующие элементы:

Цель работы — краткое описание задач, которые были решены в ходе ЛР.
Описание предметной области — описание моделей, их свойств и связей.
Структура проекта — схема папок и файлов, с указанием назначений ключевых файлов.

Описание реализации:
Как реализованы модели и их свойства (геттеры/сеттеры).
Как реализованы маршруты и обработка запросов.
Как используется шаблонизатор Jinja2 (с объяснением инициализации Environment).
Как интегрирована функция get_currencies для получения актуальных курсов.

Примеры работы приложения:
Скриншоты страниц /, /users, /currencies, /user?id=....

Примеры вывода данных.
Описание самостоятельной работы (если выполнено):
Скриншоты графиков изменения курсов валют за последние 3 месяца.
Краткое объяснение используемых библиотек и подхода.

Тестирование:
Примеры тестов для моделей, контроллера и функции get_currencies.
Скриншоты или вывод результатов тестов.

Выводы:
Какие проблемы возникли при реализации.
Как удалось применить принципы MVC.
Что нового узнали о работе с HTTPServer, Jinja2 и API курсов валют.